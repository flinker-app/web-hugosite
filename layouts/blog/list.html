{{ define "main" }}
<style>
/* Consistent blog card image sizing */
.zoom-img {
   aspect-ratio: 16 / 9;
   overflow: hidden;
}
.zoom-img img {
   width: 100%;
   height: 100%;
   object-fit: cover;
   transition: transform 0.3s ease;
}
.zoom-img:hover img {
   transform: scale(1.05);
}
</style>

<!--Square Pattern Start-->
<div class="pattern"></div>
<!--Square Pattern End-->

<!--Pageheader start-->
<section class="py-5 py-lg-8">
   <div class="container">
      <div class="row">
         <div class="col-lg-12 col-md-12 col-12">
            <div class="text-center">
               <h1 class="mb-3">{{ .Title | default "Latest News" }}</h1>
               <p class="mb-0">{{ .Description | default "Read about our latest product and partner announcements for Microsoft BIM innovations." }}</p>
            </div>
         </div>
      </div>
   </div>
</section>
<!--Pageheader end-->

<!--Blog grid start-->
<section class="mb-xl-9 my-4">
   <div class="container">
      <div class="row mb-5">
         <div class="col-lg-5 col-md-7 col-12">
            <div class="row g-2 g-sm-3 align-items-center">
               <div class="col-lg-6 col-md-6 col-12">
                  <form>
                     <label for="searchInput" class="form-label visually-hidden">Search Blog</label>
                     <input type="search" class="form-control" id="searchInput" placeholder="Search Blog" />
                  </form>
               </div>
               <div class="col-lg-6 col-md-6 col-12">
                  <label for="categoryList" class="form-label visually-hidden">Search Category</label>
                  <select class="form-select" id="categoryList">
                     <option selected value="">All Categories</option>
                     {{- $categories := slice -}}
                     {{- range .Pages -}}
                        {{- range .Params.categories -}}
                           {{- $categories = $categories | append . -}}
                        {{- end -}}
                     {{- end -}}
                     {{- $categories = $categories | uniq | sort -}}
                     {{- range $categories }}
                     <option value="{{ . }}">{{ . }}</option>
                     {{- end }}
                  </select>
               </div>
            </div>
         </div>
      </div>

      <div class="row gy-lg-7 gy-5">
         {{- range .Pages.ByDate.Reverse }}
         {{- if not .Draft }}
         <article class="col-lg-4 col-md-6 col-12" data-category="{{ with .Params.categories }}{{ index . 0 }}{{ end }}">
            <figure class="mb-4 zoom-img">
               <a href="{{ .RelPermalink }}">
                  {{- $featuredImage := "" -}}
                  {{- if .Params.featured_image -}}
                     {{- if hasPrefix .Params.featured_image "/" -}}
                        {{- $featuredImage = .Params.featured_image -}}
                     {{- else -}}
                        {{- $featuredImage = printf "%s%s" .RelPermalink .Params.featured_image -}}
                     {{- end -}}
                  {{- else -}}
                     {{- $featuredImage = "/assets-flinker/images/blog/blog-default.svg" -}}
                  {{- end -}}
                  <img src="{{ $featuredImage }}" alt="{{ .Title }}" class="img-fluid rounded-3" />
               </a>
            </figure>

            {{- $category := "Technology" -}}
            {{- $badgeClass := "bg-primary-subtle text-primary-emphasis" -}}
            {{- with .Params.categories -}}
               {{- $category = index . 0 -}}
               {{- if eq $category "Compliance" -}}
                  {{- $badgeClass = "bg-primary-subtle text-primary-emphasis" -}}
               {{- else if eq $category "Data Management" -}}
                  {{- $badgeClass = "bg-success-subtle text-success-emphasis" -}}
               {{- else if eq $category "Technology" -}}
                  {{- $badgeClass = "bg-warning-subtle text-warning-emphasis" -}}
               {{- else if eq $category "Construction" -}}
                  {{- $badgeClass = "bg-info-subtle text-info-emphasis" -}}
               {{- else if eq $category "Partnerships" -}}
                  {{- $badgeClass = "bg-secondary-subtle text-secondary-emphasis" -}}
               {{- end -}}
            {{- end -}}
            <a href="#!" class="badge {{ $badgeClass }} rounded-pill text-uppercase">{{ $category }}</a>

            <h3 class="my-3 lh-base h4">
               <a href="{{ .RelPermalink }}" class="text-reset">{{ .Title }}</a>
            </h3>

            <div class="d-flex align-items-center justify-content-between mb-3 mb-md-0">
               <div class="d-flex align-items-center">
                  {{- $authorImage := .Params.author_image | default "/assets/images/avatar/avatar-7.jpg" -}}
                  <img src="{{ $authorImage }}" alt="{{ .Params.author | default "Author" }}" class="avatar avatar-xs rounded-circle" />
                  <div class="ms-2">
                     <span class="text-reset fs-6">{{ .Params.author | default "Flinker Team" }}</span>
                  </div>
               </div>
               <div class="ms-3">
                  <span class="fs-6">{{ .Date.Format "Jan 2, 2006" }}</span>
               </div>
            </div>
         </article>
         {{- end }}
         {{- end }}
      </div>
   </div>
</section>
<!--Blog grid end-->

<script>
// Blog search and filter functionality
document.addEventListener('DOMContentLoaded', function() {
   const searchInput = document.getElementById('searchInput');
   const categorySelect = document.getElementById('categoryList');
   const articles = document.querySelectorAll('article[data-category]');

   function filterArticles() {
      const searchTerm = searchInput.value.toLowerCase();
      const selectedCategory = categorySelect.value;

      articles.forEach(article => {
         const title = article.querySelector('h3').textContent.toLowerCase();
         const category = article.dataset.category;

         const matchesSearch = title.includes(searchTerm);
         const matchesCategory = !selectedCategory || category === selectedCategory;

         article.style.display = (matchesSearch && matchesCategory) ? '' : 'none';
      });
   }

   searchInput.addEventListener('input', filterArticles);
   categorySelect.addEventListener('change', filterArticles);
});
</script>
{{ end }}
